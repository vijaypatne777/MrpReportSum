sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/table/library","sap/ui/core/format/DateFormat","sap/ui/model/Sorter","sap/m/Token","sap/ui/model/type/String","sap/ui/model/json/JSONModel","sap/m/ColumnListItem","sap/m/Label","sap/ui/core/util/Export","sap/m/MessageBox","sap/ui/core/util/ExportTypeCSV","sap/m/SearchField"],function(e,t,a,r,l,i,n,s,o,u,d,p,m,P){"use strict";var M=a.SortOrder;var v="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var f={};var R={items:[]};var y={MatList:[]};var R={BotList:[]};var c={oBotList:[]};var g;return e.extend("PP.mrpReport.controller.Home",{onInit:function(){var e=this.getView();var t=e.byId("multiInput2");t.addValidator(function(e){debugger;var t=e.text;return new i({key:t,text:t})});this.oFilterBar=null;var a=this.getView().getId();this.oFilterBar=sap.ui.getCore().byId(a+"--filterBar");this.oFilterBar.registerFetchData(this.fFetchData);this.oFilterBar.registerApplyData(this.fApplyData);this.oFilterBar.registerGetFiltersWithValues(this.fGetFiltersWithValues);this.fVariantStub();this.oFilterBar.fireInitialise();this._sHeader=this.oFilterBar.getHeader()},onSearchFbar:function(){debugger},onClear:function(e){var t=this.oFilterBar.getAllFilterItems(true);for(var a=0;a<t.length;a++){var r=this.oFilterBar.determineControlByFilterItem(t[a]);if(r){r.setValue("")}}},onFiltersDialogClosed:function(e){this._showToast("filtersDialogClosed triggered")},fFetchData:function(){var e;var t=[];var a;var r=this.getAllFilterItems(true);for(var l=0;l<r.length;l++){e={};a=null;if(r[l].getGroupName){a=r[l].getGroupName();e.groupName=a}e.name=r[l].getName();var i=this.determineControlByFilterItem(r[l]);if(i){e.value=i.getValue();t.push(e)}}return t},fApplyData:function(e){var t;for(var a=0;a<e.length;a++){t=null;if(e[a].groupName){t=e[a].groupName}var r=this.determineControlByName(e[a].name,t);if(r){r.setValue(e[a].value)}}},fGetFiltersWithValues:function(){var e;var t;var a=this.getFilterGroupItems();var r=[];for(e=0;e<a.length;e++){t=this.determineControlByFilterItem(a[e]);if(t&&t.getValue&&t.getValue()){r.push(a[e])}}return r},fVariantStub:function(){var e=this.oFilterBar._oVariantManagement;e.initialise=function(){this.fireEvent("initialise");this._setStandardVariant();this._setSelectedVariant()};var t=0;var a={};var r=null;e._oVariantSet={getVariant:function(e){return a[e]},addVariant:function(e){var r=""+t++;var l={key:r,name:e,getItemValue:function(e){return this[e]},setItemValue:function(e,t){this[e]=t},getVariantKey:function(){return this.key}};a[r]=l;return l},setCurrentVariantKey:function(e){r=e},getCurrentVariantKey:function(){return r},delVariant:function(e){if(a[e]){delete a[e]}}}},onSubmitInput:function(e){debugger;var t=e.getParameters().value.toUpperCase();if(t!==""){var a=this.getView();var r=a.byId("multiInput2");var l={items:[]};var i="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var n=new sap.ui.model.odata.ODataModel(i,true);var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,t));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,o);var M=new sap.ui.model.Filter({filters:[P],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,M,d],and:true}));n.read("/A_MRPMaterial",{async:false,filters:[v],success:function(e,a){var r=e.results;var i=r.length;if(i!==0){for(var n=0;n<i;n++){l.items.push({Material:r[n].Material,MaterialName:r[n].MaterialName})}}else{g=null;l=null;sap.m.MessageToast.show("No value found for material   "+t+".Please delete.");t=null}}})}},onDataExport:function(e){var t=new sap.ui.model.json.JSONModel;t.setData(R.BotList);var a=new d({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:",",charset:"utf-8"}),models:t,rows:{path:"/"},columns:[{name:"Material",template:{content:"{Material}"}},{name:"MRPPlant",template:{content:"{MRPPlant}"}},{name:"MRPArea",template:{content:"{MRPArea}"}},{name:"MaterialName",template:{content:"{MaterialName}"}},{name:"Supplier",template:{content:"{MRPElementBusinessPartner}"}},{name:"End Date",template:{content:"{MRPElementAvailyOrRqmtDate}"}},{name:"Availablity",template:{content:"{MRPAvailableQuantity}"}},{name:"Availablity Date",template:{content:"{MRPAvailableQuantityDate}"}},{name:"SafetyStk",template:{content:"{SafetyStk}"}},{name:"Stock",template:{content:"{Stock}"}},{name:"AvailableStock",template:{content:"{AvailableStock}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"PurchReq",template:{content:"{PurchReq}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"Plndorder",template:{content:"{Plndorder}"}},{name:"IndReqmt",template:{content:"{IndReqmt}"}},{name:"Order",template:{content:"{Order}"}},{name:"ProdOrder",template:{content:"{ProdOrder}"}},{name:"Delivery",template:{content:"{Delivery}"}},{name:"POitem",template:{content:"{POitem}"}},{name:"OrderRes",template:{content:"{OrderRes}"}},{name:"RetrnsItem",template:{content:"{RetrnsItem}"}}]});a.saveFile().always(function(){this.destroy()})},onHelpTable:function(e){debugger;sap.m.MessageToast.show("Please wait !!! fetching list of Material for you ");var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();if(t!==""||a!==""){var r={items:[]};if(!this.tableDialog){this.tableDialog=sap.ui.xmlfragment("PP.mrpReport.fragments.ValueHelpPopup",this);this.getView().addDependent(this.tableDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.tableDialog)}this.tableDialog.open();var l=sap.ui.getCore().byId("botTabDialog");l.getColumns()[0].setProperty("visible",true);var i=new sap.ui.model.json.JSONModel;i.setData(r);var n="/OPENSAP/sap/opu/odata/sap/API_PRODUCT_SRV";var s=new sap.ui.model.odata.ODataModel(n,true);var o="A_ProductPlant";debugger;var u=this.getView().byId("idMRPControl").getValue().toUpperCase();this.tableDialog.setBusy(true);if(u===""){var d="/A_ProductPlant?top=10&$orderby=Product&$select=Product,Plant&$filter=( Plant eq '"+t+"')"}if(u!==""){var d="/A_ProductPlant?top=10&$orderby=Product&$select=Product,Plant&$filter=( Plant eq '"+t+"')"}sap.ui.core.BusyIndicator.show();s.read(d,{success:function(e,t){var a=e.results;var n=a.length;if(n!==0){for(var s=0;s<n;s++){r.items.push({Material:a[s].Product,Plant:a[s].Plant})}sap.ui.core.BusyIndicator.hide()}else{r=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}i.setData(r);c=r;l.setModel(i,"botTabModel3");l.setVisible(true)}})}else{sap.m.MessageToast.show("Please provide MRP Area and Plant")}this.tableDialog.setBusy(false)},onConfirm:function(e){var t={MatList:[]};var a=sap.ui.getCore().byId("botTabDialog");var r=a.getModel("botTabModel3");var l=a.getSelectedItems();var i=l.length;var n=this.getView();var s=n.byId("multiInput2");for(var o=0;o<i;o++){var u=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath;var d=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath.slice(7,15);var p=r.oData.items[d].Material;var m=r.oData.items[d].MaterialName;s.addToken(new sap.m.Token({key:p,text:p}));t.MatList.push({Material:p,MaterialName:m})}debugger;var P=s.getTokens();i=P.length;s.removeAllTokens();for(var o=0;o<i;o++){if(o>0){var M=o-1;if(P[M].mProperties.key===P[o].mProperties.key){break}}s.addToken(new sap.m.Token({key:P[o].mProperties.key,text:P[o].mProperties.key}))}this.tableDialog.close()},onCancel:function(){this.tableDialog.close()},onSuggestLive:function(e){debugger;var t={items:[]};var a="/OPENSAP/sap/opu/odata/sap/API_PRODUCT_SRV";var r=new sap.ui.model.odata.ODataModel(a,true);var l="A_ProductPlant";var i=this.getView();var n=e.mParameters.suggestValue;var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Product",sap.ui.model.FilterOperator.EQ,e.mParameters.query.toUpperCase()));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("Plant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new Array(new sap.ui.model.Filter({filters:[m,d],and:true}));r.read("/A_ProductPlant",{async:false,filters:[P],success:function(e,a){var r=e.results;var l=r.length;if(l!==0){for(var i=0;i<l;i++){t.items.push({Material:r[i].Product})}}else{t=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}}});var M=e.getParameter("suggestValue");var v=new sap.ui.model.json.JSONModel;var i=this.getView();var n=i.byId("multiInput2");var f=n.getValue();n.setValue="";v.setData(t);var R=n._getTokensList().getItems();var y=n._getTokensList().getItems().length;debugger;for(var c=0;c<t.items.length;c++){for(var g=0;g<y;g++){if(t.items[c].Material!==n._getTokensList().getItems()[g].mProperties.title){n.addToken(new sap.m.Token({key:t.items[c].Material,text:t.items[c].Material}))}}}if(R.length===0){for(var c=0;c<t.items.length;c++){n.addToken(new sap.m.Token({key:t.items[c].Material,text:t.items[c].Material}))}}i.setModel(v,"botModelSugg");this.oSF=sap.ui.getCore().byId("searchField");this.oSF.suggest()},_validateMaterial:function(){debugger;var e=this.getView().byId("idMRPControl").getValue().toUpperCase();var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var r=this.getView();var l=r.byId("multiInput2");var i=l.getTokens();var n={items:[]};var s="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var o=new sap.ui.model.odata.ODataModel(s,true);var u=[];for(var d=0;d<i.length;d++){u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i[d].mProperties.key.toUpperCase()))}var p=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var m=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,t);var P=new sap.ui.model.Filter({filters:[m],and:true});var M=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,a);var v=new sap.ui.model.Filter({filters:[M],and:true});var f=new Array(new sap.ui.model.Filter({filters:[P,v,p],and:true}));o.read("/A_MRPMaterial",{async:false,filters:[f],success:function(e,t){var a=e.results;var r=a.length;if(r!==0){for(var l=0;l<r;l++){n.items.push({Material:a[l].Material,MaterialName:a[l].MaterialName})}}}});return n.items},onSearch:function(e){debugger;var t=this.getView().byId("idMRPControl").getValue().toUpperCase();var a=this.getView().byId("idFieldPlant").getValue().toUpperCase();var r=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var l=this.getView();var i=l.byId("multiInput2");var n=i.getTokens();var s={items:[]};s.items=this._validateMaterial();if(a!==""||r!==""||n.length>0){var o=[];for(var u=0;u<n.length;u++){o.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i.getTokens()[u].mProperties.key.toUpperCase()))}var d=new sap.ui.model.Filter({filters:o,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,a);var m=new sap.ui.model.Filter({filters:[p],and:true});var P=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,r);var M=new sap.ui.model.Filter({filters:[P],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,M,d],and:true}));debugger;if(t!==""){var f=new sap.ui.model.Filter("MRPController",sap.ui.model.FilterOperator.EQ,t);var y=new sap.ui.model.Filter({filters:[f],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,M,d,y],and:true}))}var c="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var g="/SupplyDemandItems";var S=new sap.ui.model.odata.ODataModel(c,true);S.setHeaders({"Content-Type":"application/json",Accept:"application/json",APIKey:"jQdx3TI7jIFCKaxK3GR4r5dYqF8heA4q"});var h={};var b=[];var F={};var O=[];S.read(g,{async:false,filters:[v],success:function(e,t){var a=e.results;var r=a.length;var l=0;debugger;var i;for(var n=0;n<r;n++){l++;if(a[n].MRPAvailableQuantity>0&&a[n].MRPElementCategoryShortName!=="SafetyStk"&&i!=="true"){h.MRPAvailableQuantity=parseFloat(a[n].MRPAvailableQuantity);h.MRPAvailableQuantityDate=a[n].MRPElementAvailyOrRqmtDate.toISOString();i="true"}if(l===r){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);h.Material=a[n].Material;h.SafetyStk=parseFloat(h.SafetyStk)+s;if(h.SafetyStk===undefined){h.SafetyStk=0}if(h.SafetyStk!==0){h.SafetyStk*=-1}b.push(h);i="false";s=0;h={}}else{h.Material=a[n].Material;h.SafetyStk=s;if(h.SafetyStk===undefined){h.SafetyStk=0}if(h.SafetyStk!==0){h.SafetyStk*=-1}b.push(h);i="false";s=0;h={}}}else{if(a[n].Material===a[n+1].Material){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);h.Material=a[n].Material;h.SafetyStk=parseFloat(h.SafetyStk)+s}}else{if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);h.Material=a[n].Material;h.SafetyStk=parseFloat(h.SafetyStk)+s;if(h.SafetyStk===undefined){h.SafetyStk=0}if(h.SafetyStk!==0){h.SafetyStk*=-1}b.push(h);i="false";s=0;h={}}else{h.Material=a[n].Material;h.SafetyStk=s;if(h.SafetyStk===undefined){h.SafetyStk=0}if(h.SafetyStk!==0){h.SafetyStk*=-1}b.push(h);i="false";s=0;h={}}}}F.Material=a[n].Material;F.MRPPlant=a[n].MRPPlant;F.MRPArea=a[n].MRPArea;F.MRPController=a[n].MRPController;F.MRPElementCategoryShortName=a[n].MRPElementCategoryShortName;F.MRPElementOpenQuantity=a[n].MRPElementOpenQuantity;F.MRPElementAvailyOrRqmtDate=new Date(a[n].MRPElementAvailyOrRqmtDate);F.MaterialBaseUnit=a[n].MaterialBaseUnit;F.MRPElementBusinessPartner=a[n].MRPElementBusinessPartner;O.push(F);F={}}}});if(O.length!==0){var k={};var A=[];var E=O.length;for(var D=0;D<E;D++){for(var I=0;I<s.items.length;I++){if(O[D].Material===s.items[I].Material){k.MaterialName=s.items[I].MaterialName;break}}for(var Q=0;Q<b.length;Q++){if(O[D].Material===b[Q].Material){k.SafetyStk=b[Q].SafetyStk;k.MRPAvailableQuantity=b[Q].MRPAvailableQuantity;k.MRPAvailableQuantityDate=b[Q].MRPAvailableQuantityDate;break}}k.Material=O[D].Material;k.MRPPlant=O[D].MRPPlant;k.MRPArea=O[D].MRPArea;k.MRPController=O[D].MRPController;k.MaterialBaseUnit=O[D].MaterialBaseUnit;k.MRPElementAvailyOrRqmtDate=O[D].MRPElementAvailyOrRqmtDate;k.MRPElementCategoryShortName=O[D].MRPElementCategoryShortName;k.MRPElementOpenQuantity=O[D].MRPElementOpenQuantity;k.MRPElementBusinessPartner=O[D].MRPElementBusinessPartner;A.push(k);k={}}var w=[];w=A;var C=0;var k={};var V=[];k.Stock=0;k.SafetyStk=0;k.AvailableStock=0;k.DependReq=0;k.PurchReq=0;for(var D=0;D<w.length;D++){C++;if(C===w.length){var q="X";var N=w[D].MRPElementCategoryShortName;var T=N.trim();switch(T){case"Stock":if(k.Stock===undefined){k.Stock=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Stock=parseFloat(k.Stock)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"DependReq":if(k.DependReq===undefined){k.DependReq=parseFloat(w[D].MRPElementOpenQuantity)}else{k.DependReq=parseFloat(k.DependReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PurchReq":if(k.PurchReq===undefined){k.PurchReq=parseFloat(w[D].MRPElementOpenQuantity)}else{k.PurchReq=parseFloat(k.PurchReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Plnd order":if(k.Plndorder===undefined){k.Plndorder=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Plndorder=parseFloat(k.Plndorder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"IndReqmt":if(k.IndReqmt===undefined){k.IndReqmt=parseFloat(w[D].MRPElementOpenQuantity)}else{k.IndReqmt=parseFloat(k.IndReqmt)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Order":if(k.Order===undefined){k.Order=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Order=parseFloat(k.Order)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"ProdOrder":if(k.ProdOrder===undefined){k.ProdOrder=parseFloat(w[D].MRPElementOpenQuantity)}else{k.ProdOrder=parseFloat(k.ProdOrder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Delivery":if(k.Delivery===undefined){k.Delivery=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Delivery=parseFloat(k.Delivery)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PO item":if(k.POitem===undefined){k.POitem=parseFloat(w[D].MRPElementOpenQuantity)}else{k.POitem=parseFloat(k.POitem)+parseFloat(w[D].MRPElementOpenQuantity)}k.MRPElementBusinessPartner=w[D].MRPElementBusinessPartner;break;case"OrderRes":if(k.OrderRes===undefined){k.OrderRes=parseFloat(w[D].MRPElementOpenQuantity)}else{k.OrderRes=parseFloat(k.OrderRes)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"RetrnsItem":if(k.RetrnsItem===undefined){k.RetrnsItem=parseFloat(w[D].MRPElementOpenQuantity)}else{k.RetrnsItem=parseFloat(k.RetrnsItem)+parseFloat(w[D].MRPElementOpenQuantity)}break}k.SafetyStk=parseFloat(w[D].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var _=new Date(w[D].MRPElementAvailyOrRqmtDate);var B=_.toISOString();k.MRPElementAvailyOrRqmtDate=B.substr(0,10);k.Material=w[D].Material;k.MRPPlant=w[D].MRPPlant;k.MRPArea=w[D].MRPArea;k.MRPController=w[D].MRPController;k.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=w[D].MaterialBaseUnit;k.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;k.MaterialName=w[D].MaterialName;V.push(k);k={}}else{if(w[D].Material===w[D+1].Material){N=w[D].MRPElementCategoryShortName;T=N.trim();switch(T){case"Stock":if(k.Stock===undefined){k.Stock=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Stock=parseFloat(k.Stock)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"DependReq":if(k.DependReq===undefined){k.DependReq=parseFloat(w[D].MRPElementOpenQuantity)}else{k.DependReq=parseFloat(k.DependReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PurchReq":if(k.PurchReq===undefined){k.PurchReq=parseFloat(w[D].MRPElementOpenQuantity)}else{k.PurchReq=parseFloat(k.PurchReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Plnd order":if(k.Plndorder===undefined){k.Plndorder=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Plndorder=parseFloat(k.Plndorder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"IndReqmt":if(k.IndReqmt===undefined){k.IndReqmt=parseFloat(w[D].MRPElementOpenQuantity)}else{k.IndReqmt=parseFloat(k.IndReqmt)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Order":if(k.Order===undefined){k.Order=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Order=parseFloat(k.Order)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"ProdOrder":if(k.ProdOrder===undefined){k.ProdOrder=parseFloat(w[D].MRPElementOpenQuantity)}else{k.ProdOrder=parseFloat(k.ProdOrder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Delivery":if(k.Delivery===undefined){k.Delivery=parseFloat(w[D].MRPElementOpenQuantity)}else{k.Delivery=parseFloat(k.Delivery)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PO item":if(k.POitem===undefined){k.POitem=parseFloat(w[D].MRPElementOpenQuantity)}else{k.POitem=parseFloat(k.POitem)+parseFloat(w[D].MRPElementOpenQuantity)}k.MRPElementBusinessPartner=w[D].MRPElementBusinessPartner;break;case"OrderRes":if(k.OrderRes===undefined){k.OrderRes=parseFloat(w[D].MRPElementOpenQuantity)}else{k.OrderRes=parseFloat(k.OrderRes)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"RetrnsItem":if(k.RetrnsItem===undefined){k.RetrnsItem=parseFloat(w[D].MRPElementOpenQuantity)}else{k.RetrnsItem=parseFloat(k.RetrnsItem)+parseFloat(w[D].MRPElementOpenQuantity)}break}}if(q==="X"){if(k.SafetyStk===undefined){k.SafetyStk=0}k.SafetyStk=parseFloat(w[D].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var _=new Date(w[D].MRPElementAvailyOrRqmtDate);var B=_.toISOString();k.MRPElementAvailyOrRqmtDate=B.substr(0,10);k.Material=w[D].Material;k.MRPPlant=w[D].MRPPlant;k.MRPArea=w[D].MRPArea;k.MRPController=w[D].MRPController;k.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=w[D].MaterialBaseUnit;k.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;k.MaterialName=w[D].MaterialName;V.push(k);k={}}else{if(w[D].Material!==w[D+1].Material){if(k.SafetyStk===undefined){k.SafetyStk=0}k.SafetyStk=parseFloat(w[D].SafetyStk);k.AvailableStock=parseFloat(k.Stock)-parseFloat(k.SafetyStk);if(k.AvailableStock===undefined||k.AvailableStock==="NaN"){k.AvailableStock=0}if(k.AvailableStock<0){k.status="Warning"}var _=new Date(w[D].MRPElementAvailyOrRqmtDate);var B=_.toISOString();k.MRPElementAvailyOrRqmtDate=B.substr(0,10);k.Material=w[D].Material;k.MRPPlant=w[D].MRPPlant;k.MRPArea=w[D].MRPArea;k.MRPController=w[D].MRPController;k.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){k.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}k.MaterialBaseUnit=w[D].MaterialBaseUnit;k.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;k.MaterialName=w[D].MaterialName;V.push(k);k={}}}}}R.BotList=V;var U=new sap.ui.model.json.JSONModel;var x=sap.ui.getCore().byId("container-mrpReport---Home--idTable");U.setData(R);x.setModel(U,"botTabModel");x.setVisible(true)}else{sap.m.MessageToast.show("No Data Found. Please provide correct data !!!")}}else{sap.m.MessageToast.show("Please provide Material Number, MRP Area and Plant value")}},sortCategories:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var r=t.byId("Material");a.sort(r,this._bSortColumnDescending?M.Descending:M.Ascending,true);this._bSortColumnDescending=!this._bSortColumnDescending},sortCategoriesAndName:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");a.sort(t.byId("Material"),M.Ascending,false);a.sort(t.byId("MRPPlant"),M.Ascending,true)},sortDeliveryDate:function(e){var t=e.getParameter("column");var a=this.byId("deliverydate");if(t!=a){a.setSorted(false);return}e.preventDefault();var i=e.getParameter("sortOrder");var n=r.getDateInstance({pattern:"dd/MM/yyyy"});this._resetSortingState();a.setSorted(true);a.setSortOrder(i);var s=new l(a.getSortProperty(),i===M.Descending);s.fnCompare=function(e,t){if(t==null){return-1}if(e==null){return 1}var a=n.parse(e).getTime();var r=n.parse(t).getTime();if(a<r){return-1}if(a>r){return 1}return 0};this.byId("idTable").getBinding("rows").sort(s)},_resetSortingState:function(){var e=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var t=e.getColumns();for(var a=0;a<t.length;a++){t[a].setSorted(false)}}})});