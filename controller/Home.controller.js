sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/table/library","sap/ui/core/format/DateFormat","sap/ui/model/Sorter","sap/m/Token","sap/ui/model/type/String","sap/ui/model/json/JSONModel","sap/m/ColumnListItem","sap/m/Label","sap/ui/core/util/Export","sap/m/MessageBox","sap/ui/core/util/ExportTypeCSV","sap/m/SearchField"],function(e,t,a,r,l,i,n,s,o,u,d,p,m,M){"use strict";var P=a.SortOrder;var v="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var R={};var f={items:[]};var y={MatList:[]};var f={BotList:[]};var S={oBotList:[]};var g;return e.extend("PP.mrpReport.controller.Home",{onInit:function(){var e=this.getView();var t=e.byId("multiInput2");t.addValidator(function(e){debugger;var t=e.text;return new i({key:t,text:t})});this.oFilterBar=null;var a=this.getView().getId();this.oFilterBar=sap.ui.getCore().byId(a+"--filterBar");this.oFilterBar.registerFetchData(this.fFetchData);this.oFilterBar.registerApplyData(this.fApplyData);this.oFilterBar.registerGetFiltersWithValues(this.fGetFiltersWithValues);this.fVariantStub();this.oFilterBar.fireInitialise();this._sHeader=this.oFilterBar.getHeader()},onSearchFbar:function(){debugger},onClear:function(e){var t=this.oFilterBar.getAllFilterItems(true);for(var a=0;a<t.length;a++){var r=this.oFilterBar.determineControlByFilterItem(t[a]);if(r){r.setValue("")}}},onFiltersDialogClosed:function(e){this._showToast("filtersDialogClosed triggered")},fFetchData:function(){var e;var t=[];var a;var r=this.getAllFilterItems(true);for(var l=0;l<r.length;l++){e={};a=null;if(r[l].getGroupName){a=r[l].getGroupName();e.groupName=a}e.name=r[l].getName();var i=this.determineControlByFilterItem(r[l]);if(i){e.value=i.getValue();t.push(e)}}return t},fApplyData:function(e){var t;for(var a=0;a<e.length;a++){t=null;if(e[a].groupName){t=e[a].groupName}var r=this.determineControlByName(e[a].name,t);if(r){r.setValue(e[a].value)}}},fGetFiltersWithValues:function(){var e;var t;var a=this.getFilterGroupItems();var r=[];for(e=0;e<a.length;e++){t=this.determineControlByFilterItem(a[e]);if(t&&t.getValue&&t.getValue()){r.push(a[e])}}return r},fVariantStub:function(){var e=this.oFilterBar._oVariantManagement;e.initialise=function(){this.fireEvent("initialise");this._setStandardVariant();this._setSelectedVariant()};var t=0;var a={};var r=null;e._oVariantSet={getVariant:function(e){return a[e]},addVariant:function(e){var r=""+t++;var l={key:r,name:e,getItemValue:function(e){return this[e]},setItemValue:function(e,t){this[e]=t},getVariantKey:function(){return this.key}};a[r]=l;return l},setCurrentVariantKey:function(e){r=e},getCurrentVariantKey:function(){return r},delVariant:function(e){if(a[e]){delete a[e]}}}},onSubmitInput:function(e){debugger;var t=e.getParameters().value.toUpperCase();if(t!==""){var a=this.getView();var r=a.byId("multiInput2");var l={items:[]};var i="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var n=new sap.ui.model.odata.ODataModel(i,true);var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,t));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var M=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,o);var P=new sap.ui.model.Filter({filters:[M],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,P,d],and:true}));n.read("/A_MRPMaterial",{async:false,filters:[v],success:function(e,a){var r=e.results;var i=r.length;if(i!==0){for(var n=0;n<i;n++){l.items.push({Material:r[n].Material,MaterialName:r[n].MaterialName})}}else{g=null;l=null;sap.m.MessageToast.show("No value found for material   "+t+".Please delete.");t=null}}})}},onDataExport:function(e){var t=new sap.ui.model.json.JSONModel;t.setData(f.BotList);var a=new d({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:",",charset:"utf-8"}),models:t,rows:{path:"/"},columns:[{name:"Material",template:{content:"{Material}"}},{name:"MRPPlant",template:{content:"{MRPPlant}"}},{name:"MRPArea",template:{content:"{MRPArea}"}},{name:"MaterialName",template:{content:"{MaterialName}"}},{name:"Supplier",template:{content:"{MRPElementBusinessPartner}"}},{name:"End Date",template:{content:"{MRPElementAvailyOrRqmtDate}"}},{name:"Availablity",template:{content:"{MRPAvailableQuantity}"}},{name:"Availablity Date",template:{content:"{MRPAvailableQuantityDate}"}},{name:"SafetyStk",template:{content:"{SafetyStk}"}},{name:"Stock",template:{content:"{Stock}"}},{name:"AvailableStock",template:{content:"{AvailableStock}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"PurchReq",template:{content:"{PurchReq}"}},{name:"DependReq",template:{content:"{DependReq}"}},{name:"Plndorder",template:{content:"{Plndorder}"}},{name:"IndReqmt",template:{content:"{IndReqmt}"}},{name:"Order",template:{content:"{Order}"}},{name:"ProdOrder",template:{content:"{ProdOrder}"}},{name:"Delivery",template:{content:"{Delivery}"}},{name:"POitem",template:{content:"{POitem}"}},{name:"OrderRes",template:{content:"{OrderRes}"}},{name:"RetrnsItem",template:{content:"{RetrnsItem}"}}]});a.saveFile().always(function(){this.destroy()})},onHelpTable:function(e){debugger;sap.m.MessageToast.show("Please wait !!! fetching list of Material for you ");var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();if(t!==""||a!==""){var r={items:[]};if(!this.tableDialog){this.tableDialog=sap.ui.xmlfragment("PP.mrpReport.fragments.ValueHelpPopup",this);this.getView().addDependent(this.tableDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.tableDialog)}this.tableDialog.open();var l=sap.ui.getCore().byId("botTabDialog");l.getColumns()[1].setProperty("visible",true);var i=new sap.ui.model.json.JSONModel;i.setData(r);var n="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var s=new sap.ui.model.odata.ODataModel(n,true);var o="A_MRPMaterial";debugger;var u=this.getView().byId("idMRPControl").getValue().toUpperCase();this.tableDialog.setBusy(true);if(u===""){var d="/A_MRPMaterial?$orderby=Material&$select=Material,MaterialName&$filter=( MRPPlant eq '"+t+"' and MRPArea eq '"+a+"')"}if(u!==""){var d="/A_MRPMaterial?$orderby=Material&$select=Material,MaterialName,MRPController&$filter=( MRPPlant eq '"+t+"' and MRPArea eq '"+a+"' and MRPController eq '"+u+"')"}s.read(d,{success:function(e,t){var a=e.results;var n=a.length;if(n!==0){for(var s=0;s<n;s++){r.items.push({Material:a[s].Material,MaterialName:a[s].MaterialName,MRPController:a[s].MRPController})}}else{r=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}i.setData(r);S=r;l.setModel(i,"botTabModel3");l.setVisible(true)}})}else{sap.m.MessageToast.show("Please provide MRP Area and Plant")}this.tableDialog.setBusy(false)},onConfirm:function(e){var t={MatList:[]};var a=sap.ui.getCore().byId("botTabDialog");var r=a.getModel("botTabModel3");var l=a.getSelectedItems();var i=l.length;var n=this.getView();var s=n.byId("multiInput2");for(var o=0;o<i;o++){var u=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath;var d=a.getSelectedItems()[o].oBindingContexts.botTabModel3.sPath.slice(7,15);var p=r.oData.items[d].Material;var m=r.oData.items[d].MaterialName;s.addToken(new sap.m.Token({key:p,text:p}));t.MatList.push({Material:p,MaterialName:m})}this.tableDialog.close()},onCancel:function(){this.tableDialog.close()},onSuggestLive:function(e){debugger;var t={items:[]};var a="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var r=new sap.ui.model.odata.ODataModel(a,true);var l="A_MRPMaterial";var i=this.getView();var n=e.mParameters.suggestValue;var s=this.getView().byId("idFieldPlant").getValue().toUpperCase();var o=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var u=[];u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,e.mParameters.suggestValue.toUpperCase()));var d=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,s);var m=new sap.ui.model.Filter({filters:[p],and:true});var M=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,o);var P=new sap.ui.model.Filter({filters:[M],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,P,d],and:true}));r.read("/A_MRPMaterial",{async:false,filters:[v],success:function(e,a){var r=e.results;var l=r.length;if(l!==0){for(var i=0;i<l;i++){t.items.push({Material:r[i].Material,MaterialName:r[i].MaterialName})}}else{t=null;sap.m.MessageToast.show("The Search Criteria fetched no result. Please enter valid values")}}});var R=e.getParameter("suggestValue");var f=new sap.ui.model.json.JSONModel;var i=this.getView();var n=i.byId("multiInput2");var y=n.getValue();n.setValue="";f.setData(t);for(var S=0;S<t.items.length;S++){n.addToken(new sap.m.Token({key:t.items[S].Material,text:t.items[S].Material}))}i.setModel(f,"botModelSugg");this.oSF=sap.ui.getCore().byId("searchField");this.oSF.suggest()},_validateMaterial:function(){debugger;var e=this.getView().byId("idMRPControl").getValue().toUpperCase();var t=this.getView().byId("idFieldPlant").getValue().toUpperCase();var a=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var r=this.getView();var l=r.byId("multiInput2");var i=l.getTokens();var n={items:[]};var s="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var o=new sap.ui.model.odata.ODataModel(s,true);var u=[];for(var d=0;d<i.length;d++){u.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i[d].mProperties.key.toUpperCase()))}var p=new sap.ui.model.Filter({filters:u,or:true,_bMultiFilter:false});var m=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,t);var M=new sap.ui.model.Filter({filters:[m],and:true});var P=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,a);var v=new sap.ui.model.Filter({filters:[P],and:true});var R=new Array(new sap.ui.model.Filter({filters:[M,v,p],and:true}));o.read("/A_MRPMaterial",{async:false,filters:[R],success:function(e,t){var a=e.results;var r=a.length;if(r!==0){for(var l=0;l<r;l++){n.items.push({Material:a[l].Material,MaterialName:a[l].MaterialName})}}}});return n.items},onSearch:function(e){debugger;var t=this.getView().byId("idMRPControl").getValue().toUpperCase();var a=this.getView().byId("idFieldPlant").getValue().toUpperCase();var r=this.getView().byId("idFieldMRPArea").getValue().toUpperCase();var l=this.getView();var i=l.byId("multiInput2");var n=i.getTokens();var s={items:[]};s.items=this._validateMaterial();if(a!==""||r!==""||n.length>0){var o=[];for(var u=0;u<n.length;u++){o.push(new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,i.getTokens()[u].mProperties.key.toUpperCase()))}var d=new sap.ui.model.Filter({filters:o,or:true,_bMultiFilter:false});var p=new sap.ui.model.Filter("MRPPlant",sap.ui.model.FilterOperator.EQ,a);var m=new sap.ui.model.Filter({filters:[p],and:true});var M=new sap.ui.model.Filter("MRPArea",sap.ui.model.FilterOperator.EQ,r);var P=new sap.ui.model.Filter({filters:[M],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,P,d],and:true}));debugger;if(t!==""){var R=new sap.ui.model.Filter("MRPController",sap.ui.model.FilterOperator.EQ,t);var y=new sap.ui.model.Filter({filters:[R],and:true});var v=new Array(new sap.ui.model.Filter({filters:[m,P,d,y],and:true}))}var S="/OPENSAP/sap/opu/odata/sap/API_MRP_MATERIALS_SRV_01";var g="/SupplyDemandItems";var c=new sap.ui.model.odata.ODataModel(S,true);c.setHeaders({"Content-Type":"application/json",Accept:"application/json",APIKey:"jQdx3TI7jIFCKaxK3GR4r5dYqF8heA4q"});var F={};var b=[];var h={};var O=[];c.read(g,{async:false,filters:[v],success:function(e,t){var a=e.results;var r=a.length;var l=0;debugger;var i;for(var n=0;n<r;n++){l++;if(a[n].MRPAvailableQuantity>0&&a[n].MRPElementCategoryShortName!=="SafetyStk"&&i!=="true"){F.MRPAvailableQuantity=parseFloat(a[n].MRPAvailableQuantity);F.MRPAvailableQuantityDate=a[n].MRPElementAvailyOrRqmtDate.toISOString();i="true"}if(l===r){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);F.Material=a[n].Material;F.SafetyStk=parseFloat(F.SafetyStk)+s;if(F.SafetyStk===undefined){F.SafetyStk=0}if(F.SafetyStk!==0){F.SafetyStk*=-1}b.push(F);i="false";s=0;F={}}else{F.Material=a[n].Material;F.SafetyStk=s;if(F.SafetyStk===undefined){F.SafetyStk=0}if(F.SafetyStk!==0){F.SafetyStk*=-1}b.push(F);i="false";s=0;F={}}}else{if(a[n].Material===a[n+1].Material){if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);F.Material=a[n].Material;F.SafetyStk=parseFloat(F.SafetyStk)+s}}else{if(a[n].MRPElementCategoryShortName==="SafetyStk"){var s=parseFloat(a[n].MRPElementOpenQuantity);F.Material=a[n].Material;F.SafetyStk=parseFloat(F.SafetyStk)+s;if(F.SafetyStk===undefined){F.SafetyStk=0}if(F.SafetyStk!==0){F.SafetyStk*=-1}b.push(F);i="false";s=0;F={}}else{F.Material=a[n].Material;F.SafetyStk=s;if(F.SafetyStk===undefined){F.SafetyStk=0}if(F.SafetyStk!==0){F.SafetyStk*=-1}b.push(F);i="false";s=0;F={}}}}h.Material=a[n].Material;h.MRPPlant=a[n].MRPPlant;h.MRPArea=a[n].MRPArea;h.MRPController=a[n].MRPController;h.MRPElementCategoryShortName=a[n].MRPElementCategoryShortName;h.MRPElementOpenQuantity=a[n].MRPElementOpenQuantity;h.MRPElementAvailyOrRqmtDate=new Date(a[n].MRPElementAvailyOrRqmtDate);h.MaterialBaseUnit=a[n].MaterialBaseUnit;h.MRPElementBusinessPartner=a[n].MRPElementBusinessPartner;O.push(h);h={}}}});var A={};var k=[];var E=O.length;for(var D=0;D<E;D++){for(var I=0;I<s.items.length;I++){if(O[D].Material===s.items[I].Material){A.MaterialName=s.items[I].MaterialName;break}}for(var Q=0;Q<b.length;Q++){if(O[D].Material===b[Q].Material){A.SafetyStk=b[Q].SafetyStk;A.MRPAvailableQuantity=b[Q].MRPAvailableQuantity;A.MRPAvailableQuantityDate=b[Q].MRPAvailableQuantityDate;break}}A.Material=O[D].Material;A.MRPPlant=O[D].MRPPlant;A.MRPArea=O[D].MRPArea;A.MRPController=O[D].MRPController;A.MaterialBaseUnit=O[D].MaterialBaseUnit;A.MRPElementAvailyOrRqmtDate=O[D].MRPElementAvailyOrRqmtDate;A.MRPElementCategoryShortName=O[D].MRPElementCategoryShortName;A.MRPElementOpenQuantity=O[D].MRPElementOpenQuantity;A.MRPElementBusinessPartner=O[D].MRPElementBusinessPartner;k.push(A);A={}}var w=[];w=k;var C=0;var A={};var V=[];A.Stock=0;A.SafetyStk=0;A.AvailableStock=0;A.DependReq=0;A.PurchReq=0;for(var D=0;D<w.length;D++){C++;if(C===w.length){var q="X";var N=w[D].MRPElementCategoryShortName;var _=N.trim();switch(_){case"Stock":if(A.Stock===undefined){A.Stock=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Stock=parseFloat(A.Stock)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"DependReq":if(A.DependReq===undefined){A.DependReq=parseFloat(w[D].MRPElementOpenQuantity)}else{A.DependReq=parseFloat(A.DependReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PurchReq":if(A.PurchReq===undefined){A.PurchReq=parseFloat(w[D].MRPElementOpenQuantity)}else{A.PurchReq=parseFloat(A.PurchReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Plnd order":if(A.Plndorder===undefined){A.Plndorder=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Plndorder=parseFloat(A.Plndorder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"IndReqmt":if(A.IndReqmt===undefined){A.IndReqmt=parseFloat(w[D].MRPElementOpenQuantity)}else{A.IndReqmt=parseFloat(A.IndReqmt)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Order":if(A.Order===undefined){A.Order=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Order=parseFloat(A.Order)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"ProdOrder":if(A.ProdOrder===undefined){A.ProdOrder=parseFloat(w[D].MRPElementOpenQuantity)}else{A.ProdOrder=parseFloat(A.ProdOrder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Delivery":if(A.Delivery===undefined){A.Delivery=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Delivery=parseFloat(A.Delivery)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PO item":if(A.POitem===undefined){A.POitem=parseFloat(w[D].MRPElementOpenQuantity)}else{A.POitem=parseFloat(A.POitem)+parseFloat(w[D].MRPElementOpenQuantity)}A.MRPElementBusinessPartner=w[D].MRPElementBusinessPartner;break;case"OrderRes":if(A.OrderRes===undefined){A.OrderRes=parseFloat(w[D].MRPElementOpenQuantity)}else{A.OrderRes=parseFloat(A.OrderRes)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"RetrnsItem":if(A.RetrnsItem===undefined){A.RetrnsItem=parseFloat(w[D].MRPElementOpenQuantity)}else{A.RetrnsItem=parseFloat(A.RetrnsItem)+parseFloat(w[D].MRPElementOpenQuantity)}break}A.SafetyStk=parseFloat(w[D].SafetyStk);A.AvailableStock=parseFloat(A.Stock)-parseFloat(A.SafetyStk);if(A.AvailableStock===undefined||A.AvailableStock==="NaN"){A.AvailableStock=0}if(A.AvailableStock<0){A.status="Warning"}var B=new Date(w[D].MRPElementAvailyOrRqmtDate);var T=B.toISOString();A.MRPElementAvailyOrRqmtDate=T.substr(0,10);A.Material=w[D].Material;A.MRPPlant=w[D].MRPPlant;A.MRPArea=w[D].MRPArea;A.MRPController=w[D].MRPController;A.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){A.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}A.MaterialBaseUnit=w[D].MaterialBaseUnit;A.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;A.MaterialName=w[D].MaterialName;V.push(A);A={}}else{if(w[D].Material===w[D+1].Material){N=w[D].MRPElementCategoryShortName;_=N.trim();switch(_){case"Stock":if(A.Stock===undefined){A.Stock=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Stock=parseFloat(A.Stock)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"DependReq":if(A.DependReq===undefined){A.DependReq=parseFloat(w[D].MRPElementOpenQuantity)}else{A.DependReq=parseFloat(A.DependReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PurchReq":if(A.PurchReq===undefined){A.PurchReq=parseFloat(w[D].MRPElementOpenQuantity)}else{A.PurchReq=parseFloat(A.PurchReq)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Plnd order":if(A.Plndorder===undefined){A.Plndorder=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Plndorder=parseFloat(A.Plndorder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"IndReqmt":if(A.IndReqmt===undefined){A.IndReqmt=parseFloat(w[D].MRPElementOpenQuantity)}else{A.IndReqmt=parseFloat(A.IndReqmt)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Order":if(A.Order===undefined){A.Order=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Order=parseFloat(A.Order)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"ProdOrder":if(A.ProdOrder===undefined){A.ProdOrder=parseFloat(w[D].MRPElementOpenQuantity)}else{A.ProdOrder=parseFloat(A.ProdOrder)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"Delivery":if(A.Delivery===undefined){A.Delivery=parseFloat(w[D].MRPElementOpenQuantity)}else{A.Delivery=parseFloat(A.Delivery)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"PO item":if(A.POitem===undefined){A.POitem=parseFloat(w[D].MRPElementOpenQuantity)}else{A.POitem=parseFloat(A.POitem)+parseFloat(w[D].MRPElementOpenQuantity)}A.MRPElementBusinessPartner=w[D].MRPElementBusinessPartner;break;case"OrderRes":if(A.OrderRes===undefined){A.OrderRes=parseFloat(w[D].MRPElementOpenQuantity)}else{A.OrderRes=parseFloat(A.OrderRes)+parseFloat(w[D].MRPElementOpenQuantity)}break;case"RetrnsItem":if(A.RetrnsItem===undefined){A.RetrnsItem=parseFloat(w[D].MRPElementOpenQuantity)}else{A.RetrnsItem=parseFloat(A.RetrnsItem)+parseFloat(w[D].MRPElementOpenQuantity)}break}}if(q==="X"){if(A.SafetyStk===undefined){A.SafetyStk=0}A.SafetyStk=parseFloat(w[D].SafetyStk);A.AvailableStock=parseFloat(A.Stock)-parseFloat(A.SafetyStk);if(A.AvailableStock===undefined||A.AvailableStock==="NaN"){A.AvailableStock=0}if(A.AvailableStock<0){A.status="Warning"}var B=new Date(w[D].MRPElementAvailyOrRqmtDate);var T=B.toISOString();A.MRPElementAvailyOrRqmtDate=T.substr(0,10);A.Material=w[D].Material;A.MRPPlant=w[D].MRPPlant;A.MRPArea=w[D].MRPArea;A.MRPController=w[D].MRPController;A.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){A.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}A.MaterialBaseUnit=w[D].MaterialBaseUnit;A.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;A.MaterialName=w[D].MaterialName;V.push(A);A={}}else{if(w[D].Material!==w[D+1].Material){if(A.SafetyStk===undefined){A.SafetyStk=0}A.SafetyStk=parseFloat(w[D].SafetyStk);A.AvailableStock=parseFloat(A.Stock)-parseFloat(A.SafetyStk);if(A.AvailableStock===undefined||A.AvailableStock==="NaN"){A.AvailableStock=0}if(A.AvailableStock<0){A.status="Warning"}var B=new Date(w[D].MRPElementAvailyOrRqmtDate);var T=B.toISOString();A.MRPElementAvailyOrRqmtDate=T.substr(0,10);A.Material=w[D].Material;A.MRPPlant=w[D].MRPPlant;A.MRPArea=w[D].MRPArea;A.MRPController=w[D].MRPController;A.MRPAvailableQuantity=w[D].MRPAvailableQuantity;if(w[D].MRPAvailableQuantityDate!==undefined){A.MRPAvailableQuantityDate=w[D].MRPAvailableQuantityDate.substr(0,10)}A.MaterialBaseUnit=w[D].MaterialBaseUnit;A.MRPElementOpenQuantity=w[D].MRPElementOpenQuantity;A.MaterialName=w[D].MaterialName;V.push(A);A={}}}}}f.BotList=V;var U=new sap.ui.model.json.JSONModel;var x=sap.ui.getCore().byId("container-mrpReport---Home--idTable");U.setData(f);x.setModel(U,"botTabModel");x.setVisible(true)}else{sap.m.MessageToast.show("Please provide Material Number, MRP Area and Plant value")}},sortCategories:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var r=t.byId("Material");a.sort(r,this._bSortColumnDescending?P.Descending:P.Ascending,true);this._bSortColumnDescending=!this._bSortColumnDescending},sortCategoriesAndName:function(e){var t=this.getView();var a=sap.ui.getCore().byId("container-mrpReport---Home--idTable");a.sort(t.byId("Material"),P.Ascending,false);a.sort(t.byId("MRPPlant"),P.Ascending,true)},sortDeliveryDate:function(e){var t=e.getParameter("column");var a=this.byId("deliverydate");if(t!=a){a.setSorted(false);return}e.preventDefault();var i=e.getParameter("sortOrder");var n=r.getDateInstance({pattern:"dd/MM/yyyy"});this._resetSortingState();a.setSorted(true);a.setSortOrder(i);var s=new l(a.getSortProperty(),i===P.Descending);s.fnCompare=function(e,t){if(t==null){return-1}if(e==null){return 1}var a=n.parse(e).getTime();var r=n.parse(t).getTime();if(a<r){return-1}if(a>r){return 1}return 0};this.byId("idTable").getBinding("rows").sort(s)},_resetSortingState:function(){var e=sap.ui.getCore().byId("container-mrpReport---Home--idTable");var t=e.getColumns();for(var a=0;a<t.length;a++){t[a].setSorted(false)}}})});